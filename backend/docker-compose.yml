services:
  # Vector Database for Chatbot
  qdrant:
    image: qdrant/qdrant:v1.9.1
    container_name: quran-qdrant
    restart: unless-stopped
    ports:
      - "6333:6333"   # REST API
      - "6334:6334"   # gRPC API
    volumes:
      - qdrant_storage:/qdrant/storage
    environment:
      QDRANT__SERVICE__GRPC_PORT: 6334
      QDRANT__STORAGE__OPTIMIZERS__DEFAULT_SEGMENT_NUMBER: 1
      QDRANT__CLUSTER__ENABLED: "false"
    networks:
      - quran-network

  # Quran Chatbot RAG Service
  chatbot:
    build:
      context: ./chatbot
      dockerfile: Dockerfile
    container_name: quran-chatbot
    restart: unless-stopped
    ports:
      - "8001:8001"
    volumes:
      - ./chatbot/.env:/app/.env:ro
    environment:
      - QDRANT_HOST=qdrant
      - QDRANT_PORT=6333
      - CORS_ORIGINS=http://localhost:3000,http://localhost:5173
    depends_on:
      qdrant:
        condition: service_started
    networks:
      - quran-network

  # Ayah Learning Service
  learning:
    build:
      context: ./learning
      dockerfile: Dockerfile
    container_name: quran-learning
    restart: unless-stopped
    ports:
      - "8002:8002"
    environment:
      - CORS_ORIGINS=http://localhost:3000,http://localhost:5173
    networks:
      - quran-network

  # Pronunciation Assistant Service
  pronunciation:
    build:
      context: ./pronunciation
      dockerfile: Dockerfile
    container_name: quran-pronunciation
    restart: unless-stopped
    ports:
      - "8003:8003"
    volumes:
      - ./pronunciation/data:/app/data:ro
    environment:
      - TAJWEED_DATA_ROOT=/app/data/QuranAudio
      - CORS_ORIGINS=http://localhost:3000,http://localhost:5173
    networks:
      - quran-network

networks:
  quran-network:
    driver: bridge
    name: quran-network

volumes:
  qdrant_storage:
    name: quran-qdrant-storage
